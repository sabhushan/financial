---
title: "Have federal agencies become more partisan over time?"
author:
- name: Samiha Bhushan
  affiliation: '1'
  corresponding: yes
  address: Postal address
  email: my@email.com
shorttitle: Do members of Congress have an increasing level of influence on the outcome
  of federal agency financial rulemaking?
output:
  html_document:
    df_print: paged
authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.
  Enter author note here.
abstract: |
  O
keywords: keywords
wordcount: X
bibliography: r-references.bib
floatsintext: no
figurelist: no
tablelist: no
footnotelist: no
linenumbers: yes
mask: no
draft: no
documentclass: apa6
classoption: man
affiliation:
- id: '1'
  institution: University of Wisconsin-Madison
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

#Research Questions

Does variation in financial agencies' independence affect congressional success in rulemaking?

How does variation in the number of congressional coalitions affect congressional success in financial agency rulemaking?

Does either conformity or deviation from the party of the President affect congressional success?

Do members of Congress increasingly utilize partisan rhetoric over time to influence success within financial agency rulemaking?
 - Does variation in partisan rhetoric affect congressional success?


# Methods
I will gather data from 40 rules issued by financial agencies, including but not limited
to the Consumer Financial Protection Bureau, the Treasury Department, and the Office of
the Comptroller of the Currency. I focus on public comments issued by members of
Congress and focus on whether their demands were ultimately fulfilled in the final rule.
The research design additionally combines data from a previous study conducted by
Jennifer L. Selin, who determined an estimate of the level of structural independence for
several agencies during the Obama administration. My study will also include rules during
the subsequent Trump administration, wherein the Senate majority switched to the
Republican party. I will compare and contrast rules from both eras to determine if
influence from political parties have grown over time, including determining if there is an
increased presence of politicians commenting on policies.
I will also use textual analysis in addition to the hand coding to see if elected officials
use more partisan rhetoric over time. In this study, “partisan rhetoric” refers to an
individual making positive assertions about their own party or negative assertions about
the opposing party. I will also examine whether the demands of elected officials that are
the same party as the President are increasingly met over those of the opposing party.

## Participants

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.


# Results



### Simulated Data


   
---
title: "Hypothesis testing of congressional success and members of Congress' political party"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
## Sets defaults for R chunks
knitr::opts_chunk$set(echo = TRUE, # echo = TRUE means that your code will show
                      warning=FALSE,
                      message=FALSE,
                      fig.path='figs/', ## where to save figures
                      fig.height = 3,
                      fig.width = 4,
                      fig.align = 'center')
## Add any R packages you require. 
## Here are some we will use in 811:
requires <- c("tidyverse", # tidyverse includes dplyr and ggplot2
              "broom",
              "haven", 
              "devtools",
              "magrittr",
              "margins",
              "lmtest",
              "viridisLite",
              "truncnorm",
              "ggridges",
              "here")
## Install any you don't have
to_install <- c(!requires %in% rownames(installed.packages()))
install.packages(c(requires[to_install], "NA"), repos = "https://cloud.r-project.org/" )
## Load all required R packages
library(tidyverse)
library(broom)
library(haven)
library(magrittr)
library(margins)
library(here)
library(ggplot2); theme_set(theme_bw()) # global plot theme
## Colorblind and greyscale print-friendly scales
library(viridisLite)
  options(
    ggplot2.continuous.color = "viridis",
    ggplot2.continuous.fill = "viridis"
  )
  scale_color_discrete <- function(...)
    scale_color_viridis_d(..., begin = 0, end = .7)
  scale_fill_discrete <- function(...)
    scale_fill_viridis_d(..., begin = 0, end = .7)
```

Does either conformity or deviation from the party of the President affect congressional success?



One measure of agency independence may be examined by studying the effects of congressmember's party affiliation and whether it conforms with the President's party affiliation.

We have the following data for 60 congressmembers:

`Success`: whether agencies fullfilled Congressmembers' demands, measured between -2 and 2.

`Party`: "1" for if the party is the same for the congressmember and the President and "0" if the party is different between the congressmember and the President.

`Independence`: The estimates of agency independence, derived from Selin's data.

`Coalitions` : sizes of coalitions that the congressmember is affiliated with.



```{r data-sim}
library(tidyverse)
library(tibble)
library(msm)
library(kableExtra)
congressional_success <- sample(x = c(-2, -1, 0, 1, 2), 1000, prob = c(0.1, 0.3, .1, 0.4, 0.1), replace = T)
d = tibble(rule_id = c(1:1000, rep(1001:1500, 2)),
           congress_id = sample(1:2000),
           coalitions  = c(rep(1, 1000), rep(2, 1000)),
           party = c(rep(0, 1000), rep(1, 1000)),
           congressional_success = c(congressional_success, sort(congressional_success)), 
           coalition_size = rtnorm(1000, mean = 5, sd= 10, lower = 1) %>% rep(2) %>% round(), 
           party_affiliation = sample(x = c(0,1), 2000, replace = T, prob = c(0.3, .7)), 
           comments= c(rtnorm(1000, mean = 10000, sd = 100000, lower = 100), rep(1, 1000)) %>%
sample() %>% round() , 
           cong_support = c(rtnorm(1000, mean = 1, sd = 5, lower = 0), rep(0, 1000)) %>% sample() %>% round() )             
d %>% sample_n(10) %>% dplyr::select(rule_id, congress_id, everything())
```

# Hypotheses

H1: Members of Congress of the same party as the President have their demands fullfilled more often than congressmembers that are of a different politcal party. That is, the relationship between congressional success and agency independence differs by party affiliation. 

H0: There is no difference in congressional success for members of Congress of the same of differing party of the President. That is, the relationship between congressional and agency independence does not differ by party affiliation. 

# Linear regression

The dependent variable is congressional success. For congressmember $i$, let congressional success be $y_i$ in the model $y_i = \beta_0 + ... + \epsilon_i$. $\beta_0$ is the predicted salary, $\hat{y}$, when all other variables in the model are 0.


---

## A model

Does the model, $y_i = \beta_0 + \beta_1*party_i + \epsilon_i$, test the relationship of interest? 
```{r gender_model, fig.height = 1}
model <- lm(congressional_success ~ party, data = d) 
m <- model %>% 
  tidy(conf.int = TRUE) 
m
ggplot(m %>% filter(term != "(Intercept)")) + 
  aes(x = term,
      y = estimate, 
      ymin = conf.low, 
      ymax = conf.high) + 
  geom_pointrange() + 
  geom_hline(yintercept = 0, color = "grey") + 
  coord_flip() + 
  labs(x="", y="OLS Estimate")
```

```{r summary}
# scatterplots
ggplot(d) + 
  aes(x = party, y = congressional_success) + 
  geom_point(aes(alpha = coalition_size)) 
p <- ggplot(d) + 
  aes(x = party, y = congressional_success) + 
  geom_point(aes(alpha = coalition_size))
p
```

### data plot
```{r gender_plot}
# illustrating with yhat formula; more easily done with augment()
b0 <- m$estimate[1]
b1 <- m$estimate[2]
p +
  geom_line(aes(color = "Deviation", # yhat for opposition party
                y = b0 + b1*1) ) + 
  geom_line(aes(color = "Conformity", # yhat for same party
                y = b0 + b1*0) )  +
  geom_ribbon(aes(ymax = b0 + b1*1, 
                  ymin = b0 + b1*0), alpha = .1, color = NA)
```

t-test (compare model output to simple t-test of difference in mean `congressional success` by `party`).
```{r}
# tidy model output object
m 
# t-test
t.test(congressional_success ~ party, data = d) %>% tidy()
```

```{r hist-coalitions-sim, fig.width=2, fig.height=2,  out.width = "30%"}
ggplot(d, aes(x = coalition_success)) + geom_histogram()+ labs(x = "Coalition Success")
ggplot(d, aes(x = coalition_business)) + geom_histogram()+ labs(x = "Business Coalition")
ggplot(d, aes(x = coalition_size)) + geom_histogram()+ labs(x = "Coalition size")
```

```{r hist-comments-sim,  fig.width=3, fig.height=2, out.width = "49%"}
ggplot(d, aes( x= comment_length)) + geom_histogram()+ labs(x = "% (Comment length/proposed rule length)*100")
ggplot(d, aes( x= comments)) + geom_histogram() + labs(x = "Log(comments)")
```

### Simulated Results

Unsurprisingly this model yields no significant results (Figure \@ref(fig:model-success-plot-sim), Table \@ref(tab:mediation-sim)). With lobbying success as the dependent variable, the coefficient on the main variable of interest would be interpreted as a $\beta_{logmasscomments}$ increase in the five-point influence scale of lobbying success for each one-unit increase in the logged number of comments.

```{r model-success-sim}
m <- lm(coalition_success ~ 
          log(comments) + 
          comment_length + 
          coalition_business +  
          coalition_size + 
          coalition_unopposed, 
        data = d) 
```

```{r model-success-plot-sim,  fig.width=6, fig.height=2, out.width = "100%", fig.cap= "OLS model of coalition lobbying sucess with simulated data"}
library(tidyverse)
library(broom)
m %>%
  tidy(conf.int = TRUE) %>% 
  filter(term != "(Intercept)") %>% 
  ggplot() + 
  geom_hline(yintercept = 0, color = "grey") + 
  aes(x = term, 
      y = estimate, 
      ymin = conf.low, 
      ymax = conf.high) + 
  geom_pointrange( )  + 
  coord_flip() +
  labs(y = "Lobbying Success", 
       x = "") 
```

To assess the extent to which congressional support mediates the influence of public pressure campaigns on rulemaking, I estimate the average conditional marginal effect (ACME, conditional on the number of comments from Members of Congress) and average direct effect (ADE) of mass comments using mediation analysis. Model 3 in table \@ref(tab:mediation-sim) replaces the dependent varible (lobbying success) with the mediator variable (the number of supportive members of Congress). 

```{r mediation-sim}
library(mediation)
# model predicting mediator
model.m <- lm(cong_support ~  log(comments) + comment_length + coalition_business+  coalition_size + coalition_unopposed, data = d) 
# model predicting DV
model.y <- lm(coalition_success ~ log(comments) + cong_support + comment_length + coalition_business+  coalition_size + coalition_unopposed, data = d) 
med.cont <- mediate(model.m, model.y, sims=1000, treat = "log(comments)",
mediator = "cong_support")
# summary(med.cont)
library(modelsummary)
models <- list(
  "1" = m,
  "2" = model.y,
  "3"  =  model.m
)
rows <- tibble(
  term = c("Dependent Variable"),
  `1` = c("Lobbying Success"), 
  `2` =c("Lobbying Success"), 
  `3`  = c("Members of Congress in Coalition")
)

attr(rows, 'position') <- c(0)

# paper table 
modelsummary::modelsummary( models,
                            title = "Lobbying success and congressional support with simulated data",
                            stars = TRUE, 
                            #coef_omit = "president.*|agency.*|Intercept", 
                            # coef_map = cm,
                          add_rows = rows, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T)
```


The average effect of the logged number of comments, conditional on letters from members of congress (the ACME) is `r round(med.cont$d.avg, 2)`, with a p value of `r round(med.cont$d0.p, 2)`.

The average direct effect (ADE) of the logged number of comments on lobbying success is `r round(med.cont$z0, 2)`, with a p value of `r round(med.cont$z0.p, 2)`

The Total Effect of a one-unit increase in the logged number of comments is `r round(med.cont$tau.coef, 2)`, with a p value of `r round(med.cont$tau.p, 2)`. `r round(med.cont$n0, 2)` of this is mediated through mobilizing congressional attention (p-value = `r round(med.cont$n0.p, 2)`).

Running a multiple regression analysis on the overall average success and independence estimates, the correlation between the level of independence of federal agencies and average success overall for combined rules, the correlation coefficient is 'r cor(federal_agencies_table$Estimate, federal_agencies_table$Avg_Success)' and the r-squared value is 0.0043, suggesting that the 0.43% of variation in success is explained by agency's level of independence. 



# Discussion


\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
